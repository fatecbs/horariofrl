!function(a,t){a.view={init:function(){var e=this,o=t(window);e.modal=t("#modal-fav"),e.modalBtn=e.modal.find("button.btn-primary"),e.modalBtn.click(function(){return e.modalAction()}),t("body").fadeIn(100),t("main").css("min-height",o.height()-150+"px"),e.json&&e.fillCredits(),a.favorito&&e.openFavorite(),o.scroll(function(){var a=o.scrollTop(),e=t(".tab-pane.active h2"),r=e.parent().offset().top;a>r?e.hasClass("fixed")||e.addClass("fixed").parent().css("padding-top",e.outerHeight()+"px"):e.hasClass("fixed")&&e.removeClass("fixed").parent().css("padding-top","0px")})},bind:function(){var a=this;t(".nav-tabs").removeClass("blocked").find("li a").click(function(){var e=t(this).attr("aria-controls");a.loadTemplate(e)})},loadTemplate:function(e){var o,r,n,i=this,s=myApp.json.cursos[e],l=s[0].nome,d="",c=0;o=t("body .tab-content .tab-pane#"+e),""==o.html().trim()&&o.load("app/html/template_horarios.html",function(){o.prepend("<h2>"+l+"</h2>"),r=o.find(".panel.panel-default:eq(0)"),r.remove(),d+=l;for(x in s){periodoCurso=s[x];for(y in periodoCurso.semestres)semestreCurso=periodoCurso.semestres[y],n=r.clone(),semanaCurso=semestreCurso.dias_semana,i.fillPanel(n,semestreCurso,l,periodoCurso.periodo,c++),o.append(n)}t(".panel-heading .fav").click(function(){var e=t(this),o=e.parent().parent().parent().attr("id"),r=e.parent().attr("id"),n=!1;null!=a.favorito&&a.favorito.curso==o&&a.favorito.semestre==r?(n=!0,i.changeFavModal(a.textUnfav)):i.changeFavModal(a.textFav),i.modal.attr({"data-curso":o,"data-semestre":r,"data-unfav":n}),i.modal.modal()})})},fillPanel:function(a,t,e,o,r){function n(a,t){var e="<table class='table'><thead><tr><th>"+a+"</th></tr></thead><tbody>";for(dia in t)e+="<tr><td>"+t[dia].horario+" - "+t[dia].materia+" ("+t[dia].professor+")</td></tr>";return e+="</tbody></table>"}var i=a.find(".panel-title a"),s=a.find(".panel-body"),l=t.dias_semana,d="",c=String(e+o+t.legenda.replace(/(º )/,"")).replace(/ /g,"");i.attr("href","#"+c).attr("aria-controls",c),a.find(".panel-heading").attr("id","heading"+c),a.find(".panel-collapse").attr("aria-labelledby","heading"+c).attr("id",c),d+=n("Segunda",l.segunda),d+=n("Terça",l.terca),d+=n("Quarta",l.quarta),d+=n("Quinta",l.quinta),d+=n("Sexta",l.sexta),d+=n("Sábado",l.sabado),i.html(t.legenda+" ("+o+")"),s.html(d)},fillCredits:function(){var a,e,o=myApp.json.creditos,r="";for(i in o)item=o[i],a=item.nome,url=item.url,e=item.url?"<a href='"+url+"' target='_blank'>"+a+"</a>":a,r+=item.credito+e+"<br>";t("footer").html(r)},openFavorite:function(){var e=this,o=a.favorito,r=o.curso,n=o.semestre;t(".panel-collapse").css("transition","none"),t(".nav.nav-tabs li a[aria-controls="+r+"]").trigger("click"),setTimeout(function(){t(".tab-content .tab-pane#"+r+" .panel-heading#"+n+" a").trigger("click").parent().siblings(".fav").addClass("selected"),setTimeout(e.scrollToFavorite,300)},300)},modalAction:function(){var e=this.modal,o=e.attr("data-curso"),r=e.attr("data-semestre"),n="true"==e.attr("data-unfav"),i=t("#"+r).find("a"),s=i.parent().siblings(".fav");t(".tab-content .fav").removeClass("selected"),n?(s.removeClass("selected"),localStorage.removeItem("favorito"),a.favorito=null):(s.addClass("selected"),localStorage.setItem("favorito",JSON.stringify({curso:o,semestre:r})),a.favorito=JSON.parse(localStorage.favorito)),e.modal("hide")},changeFavModal:function(a){this.modal.find(".modal-body .text-center").html(a)},scrollToFavorite:function(){var e=t("#"+a.favorito.semestre);t("html,body").animate({scrollTop:e.offset().top-t(".tab-pane.active h2").outerHeight()+"px"},function(){t(".panel-collapse").css("transition","all .4s ease-in-out")})}}}(window.myApp,jQuery);
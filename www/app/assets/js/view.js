!function(a,t){a.view={init:function(){var e=this,o=t(window);e.modal=t("#modal-fav"),e.modalBtn=e.modal.find("button.btn-primary"),e.modalBtn.click(function(){return e.modalAction()}),t("body").fadeIn(100),t("main").css("min-height",o.height()-150+"px"),this.bind(),a.favorito?e.openFavorite():setTimeout(function(){t(".nav-tabs li:eq(0) a").trigger("click")},300),o.scroll(function(){var a=o.scrollTop(),e=t(".tab-pane.active h2"),i=e.parent().offset().top;a>i?e.hasClass("fixed")||e.addClass("fixed").parent().css("padding-top",e.outerHeight()+"px"):e.hasClass("fixed")&&e.removeClass("fixed").parent().css("padding-top","0px")})},reset:function(){var e=this;t(".nav-tabs").removeClass("blocked").find("li a").each(function(){var a=t(this).attr("aria-controls");e.loadTemplate(a,!0)}),setTimeout(function(){t(".tab-pane.active h2").removeClass("fixed").parent().css("padding-top","0px"),a.favorito&&t("#"+a.favorito.semestre+" .fav").addClass("selected")},300)},bind:function(){var a=this;t(".nav-tabs").removeClass("blocked").find("li a").click(function(){var e=t(this).attr("aria-controls");a.loadTemplate(e)})},loadTemplate:function(e,o){var i,n,r,s=this,l=myApp.json.cursos[e],d=l[0].nome,c="",f=0;i=t("body .tab-content .tab-pane#"+e),o&&(i.html(""),this.loadTemplate(e)),""==i.html().trim()&&i.load("app/html/template_horarios.html",function(){i.prepend("<h2>"+d+"</h2>"),n=i.find(".panel.panel-default:eq(0)"),n.remove(),c+=d;for(x in l){periodoCurso=l[x];for(y in periodoCurso.semestres)semestreCurso=periodoCurso.semestres[y],r=n.clone(),semanaCurso=semestreCurso.dias_semana,s.fillPanel(r,semestreCurso,d,periodoCurso.periodo,f++),i.append(r)}t(".panel-heading .fav").click(function(){var e=t(this),o=e.parent().parent().parent().attr("id"),i=e.parent().attr("id"),n=!1;null!=a.favorito&&a.favorito.curso==o&&a.favorito.semestre==i?(n=!0,s.changeFavModal(a.textUnfav)):s.changeFavModal(a.textFav),s.modal.attr({"data-curso":o,"data-semestre":i,"data-unfav":n}),s.modal.modal()})})},fillPanel:function(a,t,e,o,i){function n(a,t){var e="<table class='table'><thead><tr><th>"+a+"</th></tr></thead><tbody>";for(dia in t)e+="<tr><td><bdi>"+t[dia].horario+" </bdi>  <strong>"+t[dia].professor+"</strong> <i> "+t[dia].materia+"</i></td></tr>";return e+="</tbody></table>"}var r=a.find(".panel-title a"),s=a.find(".panel-body"),l=t.dias_semana,d="",c=String(e+o+t.legenda).replace(/,| |º/g,"");r.attr("href","#"+c).attr("aria-controls",c),a.find(".panel-heading").attr("id","heading"+c),a.find(".panel-collapse").attr("aria-labelledby","heading"+c).attr("id",c),d+=n("Segunda",l.segunda),d+=n("Terça",l.terca),d+=n("Quarta",l.quarta),d+=n("Quinta",l.quinta),d+=n("Sexta",l.sexta),d+=n("Sábado",l.sabado),r.html(t.legenda+" ("+o+")"),s.html(d)},fillCredits:function(){var a,e,o=myApp.json.creditos,n="";for(i in o)item=o[i],a=item.nome,url='"'+item.url+'", "_system"',e=item.url?"<a onclick='window.open("+url+")' >"+a+"</a>":a,n+=item.credito+e+"<br>";t("footer").html(n)},openFavorite:function(){function e(){var e=t("#"+a.favorito.semestre);t("html,body").animate({scrollTop:e.offset().top-t(".tab-pane.active h2").outerHeight()+"px"},function(){t(".panel-collapse").css("transition","all .4s ease-in-out")})}var o=a.favorito,i=o.curso,n=o.semestre;t(".panel-collapse").css("transition","none"),t(".nav.nav-tabs li a[aria-controls="+i+"]").trigger("click"),setTimeout(function(){t(".tab-content .tab-pane#"+i+" .panel-heading#"+n+" a").trigger("click").parent().siblings(".fav").addClass("selected"),setTimeout(e,300)},300)},modalAction:function(){var e=this.modal,o=e.attr("data-curso"),i=e.attr("data-semestre"),n="true"==e.attr("data-unfav"),r=t("#"+i).find("a"),s=r.parent().siblings(".fav");t(".tab-content .fav").removeClass("selected"),n?(s.removeClass("selected"),localStorage.removeItem("favorito"),a.favorito=null):(s.addClass("selected"),localStorage.setItem("favorito",JSON.stringify({curso:o,semestre:i})),a.favorito=JSON.parse(localStorage.favorito)),e.modal("hide")},changeFavModal:function(a){this.modal.find(".modal-body .text-center").html(a)}}}(window.myApp,jQuery);
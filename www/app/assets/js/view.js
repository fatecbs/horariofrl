!function(a,t){a.view={init:function(){var a=this,e=t(window);a.modal=t("#modal-fav"),a.modalFavBtn=a.modal.find("button.btn-primary"),a.modalFavBtn.click(function(){t(this).hasClass("update")?a.modalActionUpdate():a.modalAction()}),t("body").fadeIn(100),t("main").css("min-height",e.height()-150+"px"),e.scroll(function(){var a=e.scrollTop(),o=t(".tab-pane.active h2"),i=o.parent().offset().top;a>i?o.hasClass("fixed")||o.addClass("fixed").parent().css("padding-top",o.outerHeight()+"px"):o.hasClass("fixed")&&o.removeClass("fixed").parent().css("padding-top","0px")})},reset:function(){var e=this;e.bind(!0),setTimeout(function(){t(".tab-pane.active h2").removeClass("fixed").parent().css("padding-top","0px"),a.favorito&&t("#"+a.favorito.semestre+" .fav").addClass("selected")},300)},buildMenu:function(){var a=t(".nav-tabs"),e=t(".tab-content.listagens"),o=myApp.json.cursos,i="",n="";for(var r in o)i+='<li role="presentation"><a href="#'+r+'" aria-controls="'+r+'" role="tab" data-toggle="tab">'+r.toUpperCase()+"</a></li>",n+='<div role="tabpanel" class="tab-pane '+("si"==r?"active":"")+'" id="'+r+'"></div>';return a.html(i),e.html(n),this},bind:function(a){var e=this,o=t(".nav-tabs");return o.removeClass("blocked").find("li a").click(function(){var o=t(this).attr("aria-controls");e.loadTemplate(o,1==a)}),a=!1,myApp.favorito&&myApp.json?this.openFavorite():setTimeout(function(){t(".nav-tabs li:eq(0) a").trigger("click")},300),this},loadTemplate:function(e,o){var i,n,r,s=this,l=myApp.json.cursos[e],d=l[0].nome,c="",p=0;i=t("body .tab-content .tab-pane#"+e),o&&(i.html(""),this.loadTemplate(e,!1)),""==i.html().trim()&&i.load("app/html/template_horarios.html",function(){i.prepend("<h2>"+d+"</h2>"),n=i.find(".panel.panel-default:eq(0)"),n.remove(),c+=d;for(x in l){periodoCurso=l[x];for(y in periodoCurso.semestres)semestreCurso=periodoCurso.semestres[y],r=n.clone(),semanaCurso=semestreCurso.dias_semana,s.fillPanel(r,semestreCurso,d,periodoCurso.periodo,p++),i.append(r)}t(".panel-heading .fav").click(function(){var e=t(this),o=e.parent().parent().parent().attr("id"),i=e.parent().attr("id"),n=!1;null!=a.favorito&&a.favorito.curso==o&&a.favorito.semestre==i?(n=!0,s.changeFavModal(a.textUnfav)):s.changeFavModal(a.textFav),s.modal.attr({"data-curso":o,"data-semestre":i,"data-unfav":n}),s.modal.modal()})})},fillPanel:function(a,t,e,o,i){function n(a,t){var e="<table class='table'><thead><tr><th>"+a+"</th></tr></thead><tbody>";for(dia in t)e+="<tr><td><bdi>"+t[dia].horario+" </bdi>  <strong>"+t[dia].professor+"</strong> <i> "+t[dia].materia+"</i></td></tr>";return e+="</tbody></table>"}var r=a.find(".panel-title a"),s=a.find(".panel-body"),l=t.dias_semana,d="",c=String(e+o+t.legenda).replace(/,| |º|\(|\)/g,"");r.attr("href","#"+c).attr("aria-controls",c),a.find(".panel-heading").attr("id","heading"+c),a.find(".panel-collapse").attr("aria-labelledby","heading"+c).attr("id",c),d+=n("Segunda",l.segunda),d+=n("Terça",l.terca),d+=n("Quarta",l.quarta),d+=n("Quinta",l.quinta),d+=n("Sexta",l.sexta),d+=n("Sábado",l.sabado),r.html(t.legenda+" ("+o+")"),s.html(d)},fillCredits:function(){var a,e,o=myApp.json.creditos,n="";for(i in o)item=o[i],a=item.nome,url='"'+item.url+'", "_system"',e=item.url?"<a onclick='window.open("+url+")' >"+a+"</a>":a,n+=item.credito+e+"<br>";t("footer").html(n)},openFavorite:function(){function e(){var e=t("#"+a.favorito.semestre);e.length&&t("html,body").animate({scrollTop:e.offset().top-t(".tab-pane.active h2").outerHeight()+"px"},function(){t(".panel-collapse").css("transition","all .4s ease-in-out")})}var o=a.favorito,i=o.curso,n=o.semestre,r=t(".nav.nav-tabs li a[aria-controls="+i+"]");t(".panel-collapse").css("transition","none"),r.length?r.trigger("click"):t(".nav-tabs li:eq(0) a").trigger("click"),setTimeout(function(){t(".tab-content .tab-pane#"+i+" .panel-heading#"+n+" a").trigger("click").parent().siblings(".fav").addClass("selected"),setTimeout(e,300)},300)},modalAction:function(){var e=this.modal,o=e.attr("data-curso"),i=e.attr("data-semestre"),n="true"==e.attr("data-unfav"),r=t("#"+i).find("a"),s=r.parent().siblings(".fav");t(".tab-content .fav").removeClass("selected"),n?(s.removeClass("selected"),localStorage.removeItem("favorito"),a.favorito=null):(s.addClass("selected"),localStorage.setItem("favorito",JSON.stringify({curso:o,semestre:i})),a.favorito=JSON.parse(localStorage.favorito)),e.modal("hide")},modalActionUpdate:function(){this.modal.modal("hide"),this.buildMenu().reset()},changeFavModal:function(a){this.modal.find(".modal-body .text-center").html(a).parent().siblings(".modal-footer").children(".btn.btn-primary").removeClass("update")},updateModal:function(a){this.modal.find(".modal-body .text-center").html(a).parent().siblings(".modal-footer").children(".btn.btn-primary").addClass("update"),this.modal.modal()}}}(window.myApp,jQuery);